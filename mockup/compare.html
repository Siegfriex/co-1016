<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CuratorOdyssey - Phase 3: 비교 분석">
  <title>비교 분석 - CuratorOdyssey</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/design-system.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/responsive.css">
  
  <!-- D3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <!-- Header Navigation -->
  <nav class="header-nav" role="navigation" aria-label="메인 네비게이션">
    <div class="container">
      <a href="index.html" class="nav-link">CuratorOdyssey</a>
      <ul class="nav-links">
        <li><a href="#phase1" class="nav-link">Phase 1</a></li>
        <li><a href="#phase2" class="nav-link">Phase 2</a></li>
        <li><a href="#phase3" class="nav-link active">Phase 3</a></li>
        <li><a href="#phase4" class="nav-link">Phase 4</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main role="main" aria-label="Phase 3: 비교 분석">
    <!-- 비교 대상 선택 영역 -->
    <section class="section" id="comparison-select" aria-label="비교 대상 선택">
      <div class="container">
        <div class="comparison-selector">
          <div class="input-group">
            <label for="artist-a">아티스트 A:</label>
            <input type="text" id="artist-a" class="input" placeholder="ARTIST_0005" value="ARTIST_0005">
            <span id="artist-a-name">양혜규</span>
          </div>
          
          <div class="input-group">
            <label for="artist-b">아티스트 B:</label>
            <input type="text" id="artist-b" class="input" placeholder="ARTIST_0003" value="ARTIST_0003">
            <span id="artist-b-name">김작가</span>
          </div>

          <div class="axis-toggles">
            <button class="axis-toggle active" onclick="selectAxis('제도')">제도</button>
            <button class="axis-toggle" onclick="selectAxis('학술')">학술</button>
            <button class="axis-toggle" onclick="selectAxis('담론')">담론</button>
            <button class="axis-toggle" onclick="selectAxis('네트워크')">네트워크</button>
          </div>

          <button class="btn btn-primary" onclick="runComparison()">비교 분석 실행</button>
        </div>
      </div>
    </section>

    <!-- ComparisonAreaChart -->
    <section class="section" id="chart-section" aria-label="비교 차트">
      <div class="container">
        <div class="comparison-chart-container" id="comparison-chart" aria-label="비교 영역 차트"></div>
        
        <!-- 범례 -->
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-color" style="background-color: var(--color-compare-player);"></span>
            <span>아티스트 A</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: var(--color-compare-artist);"></span>
            <span>아티스트 B</span>
          </div>
        </div>
      </div>
    </section>

    <!-- 비교 지표 카드 -->
    <section class="section" id="metrics-section" aria-label="비교 지표">
      <div class="container">
        <div class="grid grid-landing" style="grid-template-columns: repeat(2, 1fr); gap: 24px;">
          <div class="card">
            <h3>상관계수</h3>
            <p id="correlation-value">-</p>
            <p id="correlation-label">-</p>
          </div>
          
          <div class="card">
            <h3>절대 차이 합계</h3>
            <p id="abs-diff-sum-value">-</p>
            <p id="abs-diff-sum-label">-</p>
          </div>
          
          <div class="card">
            <h3>AUC (A)</h3>
            <p id="auc-a-value">-</p>
          </div>
          
          <div class="card">
            <h3>AUC (B)</h3>
            <p id="auc-b-value">-</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 네비게이션 버튼 -->
    <section class="section" id="navigation-section" aria-label="네비게이션">
      <div class="container">
        <button class="btn btn-secondary" onclick="goToPhase2()">Phase 2로 돌아가기</button>
        <button class="btn btn-primary" onclick="goToPhase4()">Phase 4: 보고서 생성</button>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <p>CuratorOdyssey v1.0</p>
    </div>
  </footer>

  <!-- JavaScript -->
  <script src="js/config.js"></script>
  <script src="js/api-mock.js"></script>
  <script src="js/charts/comparison-chart.js"></script>
  
  <script>
    let currentAxis = '제도';
    let artistA = 'ARTIST_0005';
    let artistB = 'ARTIST_0003';

    // URL 파라미터에서 아티스트 ID 가져오기
    function getArtistsFromURL() {
      const params = new URLSearchParams(window.location.search);
      return {
        artistA: params.get('artistA') || 'ARTIST_0005',
        artistB: params.get('artistB') || 'ARTIST_0003'
      };
    }

    // 축 선택
    function selectAxis(axis) {
      currentAxis = axis;
      
      // 탭 활성화 업데이트
      document.querySelectorAll('.axis-toggle').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // 비교 실행
      runComparison();
    }

    // 비교 분석 실행
    async function runComparison() {
      artistA = document.getElementById('artist-a').value.trim();
      artistB = document.getElementById('artist-b').value.trim();

      if (!/^ARTIST_\d{4}$/.test(artistA) || !/^ARTIST_\d{4}$/.test(artistB)) {
        alert('올바른 아티스트 ID 형식을 입력해주세요.');
        return;
      }

      try {
        // 비교 데이터 로드
        const comparisonData = await apiMock.getCompareArtists(artistA, artistB, currentAxis);
        const data = comparisonData.data;

        // 지표 표시
        document.getElementById('correlation-value').textContent = data.metrics.correlation.toFixed(2);
        document.getElementById('correlation-label').textContent = 
          data.metrics.correlation > 0.8 ? '유사' : '차이 있음';
        
        document.getElementById('abs-diff-sum-value').textContent = data.metrics.abs_diff_sum.toFixed(1);
        document.getElementById('abs-diff-sum-label').textContent = 
          data.metrics.abs_diff_sum > 100 ? '차이 있음' : '유사';
        
        document.getElementById('auc-a-value').textContent = data.metrics.auc.toFixed(1);
        document.getElementById('auc-b-value').textContent = data.metrics.auc.toFixed(1);

        // ComparisonAreaChart 렌더링
        // TODO: ComparisonAreaChart 구현 필요
        console.log('Comparison data loaded:', data);

        // 캐시 히트 표시
        if (data.cached) {
          console.log('Using cached data');
        }

      } catch (error) {
        console.error('Failed to load comparison data:', error);
      }
    }

    // Phase 2로 이동
    function goToPhase2() {
      window.location.href = `trajectory.html?id=${artistA}`;
    }

    // Phase 4로 이동
    function goToPhase4() {
      window.location.href = `report.html?id=${artistA}`;
    }

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', () => {
      const artists = getArtistsFromURL();
      artistA = artists.artistA;
      artistB = artists.artistB;
      
      document.getElementById('artist-a').value = artistA;
      document.getElementById('artist-b').value = artistB;
      
      // 비교 실행
      runComparison();
    });
  </script>
</body>
</html>

