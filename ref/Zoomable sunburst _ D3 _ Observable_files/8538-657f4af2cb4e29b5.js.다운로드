!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ab1735bb-5160-4553-89fe-21e445beaeba",e._sentryDebugIdIdentifier="sentry-dbid-ab1735bb-5160-4553-89fe-21e445beaeba")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8538],{33146:function(e,t,a){a.d(t,{Y:function(){return m}});var l=a(85893),s=a(94184),n=a.n(s),i=a(67294),r=a(79384),c=a(61802),o=a(91132);let d=/^[a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38}$/,m=e=>{let{title:t,name:a,placeholder:s,team:m,initialLogin:h,serverError:u,autoFocus:x,onLoginChange:f,onLoginValid:j}=e,b=(0,i.useRef)(),[v,g,p]=(0,o.G)(h||"",200),[y,k]=(0,i.useState)("empty"),w=m?"/team/".concat(m.id,"/alias-allowed"):"/user/alias-allowed",{data:N}=(0,c.h_)(p?"".concat(w,"?").concat(new URLSearchParams({login:p.toLocaleLowerCase()})):null);return(0,i.useEffect)(()=>{let e=p.toLowerCase();e?d.exec(e)?void 0!==N&&k(N?"valid":"conflict"):k("invalid"):k("empty")},[p,k,N]),(0,i.useEffect)(()=>{let e=p.toLowerCase();e&&e===b.current&&j("valid"===y)},[y,p,j]),(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"flex flex-column items-stretch",children:[""!==t&&(0,l.jsx)("label",{className:"pb2 f5 fw5 dark-gray",htmlFor:"login",children:t}),(0,l.jsxs)("div",{className:n()("flex items-stretch br2 ba",u||"invalid"===y||"conflict"===y?"b--dark-pink":"b--black-10"),children:[(0,l.jsxs)("div",{className:"pa2 pr0 pr1 dark-gray bg-near-white br b--black-10 br2 br--left",onClick:()=>{document.querySelector("#login").focus()},children:[location.host,"/",m?"":"user/","@"]}),(0,l.jsx)(r.Z,{id:"login",name:"login",autoComplete:"off",maxLength:255,autoFocus:x,className:"pa2 black flex-auto bn",style:{boxShadow:"none"},onChange:e=>{let{target:{value:t}}=e,a=t.toLowerCase();b.current=a,f(a),g(t)},value:v,placeholder:s})]}),(0,l.jsx)("div",{className:"h2",children:"LOGIN_CONFLICT"===u||"conflict"===y?(0,l.jsx)("div",{className:"mt1 f7 fw5 dark-pink",children:v===h?"This is your current ".concat(a,"."):"That ".concat(a," is already taken.")}):"LOGIN_INVALID"===u||"invalid"===y?(0,l.jsxs)("div",{className:"mt1 f7 fw5 dark-pink",children:["A ",a," can only include alphanumeric characters or single hyphens, can’t start or end with a hyphen, and should be less than 40 characters long."]}):null})]})})}},61865:function(e,t,a){a.d(t,{E:function(){return u},I:function(){return h}});var l=a(85893),s=a(6467),n=a(67294),i=a(27011),r=a.n(i),c=a(68059),o=a(37999),d=a(71995),m=a(26669);let h=460,u=e=>{let{fileUrl:t,onDismiss:a,onNewAvatar:i,isTeam:u=!1}=e,[x,f]=(0,n.useState)(1),j=(0,n.useRef)(null);function b(e){if(e.preventDefault(),j.current){let e=j.current.getImage(),t=[0,0,e.width,e.height],l=[0,0,h,h],s=document.createElement("canvas");s.width=h,s.height=h;let n=s.getContext("2d");n.fillStyle="#fff",n.fillRect(...l),n.drawImage(e,...t,...l),i(s.toDataURL("image/webp",100)),a()}}return(0,l.jsx)(s.Vq,{onDismiss:a,"aria-labelledby":"modal-title",children:(0,l.jsxs)(o.l,{onSubmit:b,children:[(0,l.jsx)(m.xB,{title:"Set your avatar",onDismiss:a}),(0,l.jsxs)(m.fe,{children:[(0,l.jsx)(r(),{image:t,ref:j,width:396,height:396,border:10,borderRadius:396/(u?7:2),scale:x}),(0,l.jsxs)("div",{className:"flex mt2 justify-center items-center",children:[(0,l.jsx)("label",{className:"mr2 f6 black-70",htmlFor:"scale-range",children:"Zoom"}),(0,l.jsx)(d.i,{name:"scale-range",className:"w4",onChange:e=>f(e.target.valueAsNumber),value:x,step:"any",min:1,max:2})]})]}),(0,l.jsx)(m.mz,{children:(0,l.jsxs)(c.CQ,{children:[(0,l.jsx)(c.kq,{text:"Cancel",onClick:a}),(0,l.jsx)(c.KM,{text:"Save",onClick:b,type:"submit"})]})})]})})}},8538:function(e,t,a){a.d(t,{H:function(){return L}});var l=a(85893),s=a(6467),n=a(41664),i=a.n(n),r=a(67294),c=a(89896),o=a(68059),d=a(37999),m=a(79384),h=a(14162),u=a(38613),x=a(26669),f=a(91132),j=a(99930);let b=(0,j.$j)(e=>{let{currentUser:t}=e;return{currentUser:t}},e=>({dispatch:e}))(e=>{let{onDismiss:t,updateAiServiceKey:a,settings:n}=e,j=(0,r.useRef)(null),[b,v]=(0,r.useState)(!1),[g,p]=(0,r.useState)(n.engine||c.LP.GPT_3_5),[y,k]=(0,r.useState)([]),[w,N]=(0,r.useState)(),[C,S]=(0,r.useState)(""),[D,I,A]=(0,f.G)("",700);(0,r.useEffect)(()=>{D&&D===A&&C!==A?(S(D),v(!0),N(void 0),k([]),fetch("https://api.openai.com/v1/models",{method:"GET",headers:{Authorization:"Bearer ".concat(D)}}).then(e=>{if(e.ok)return e.json();401===e.status?N("Unauthorized: invalid or expired token. Try again?"):403===e.status?N("Forbidden: insufficient permissions. Try again?"):N("Invalid API Key: status ".concat(e.status))}).then(e=>{let t=e.data.filter(e=>Object.values(c.LP).includes(e.id)).map(e=>e.id);0===t.length?N("Invalid API Key: This API key does not have access to any of the required models: ".concat(Object.values(c.LP).join(", "))):(k(t),g||p(c.LP.GPT_3_5))}).catch(e=>{console.error(e),N("Invalid API Key: ".concat(e.message))}).finally(()=>v(!1))):b||D&&D===A||(N(void 0),k([]))},[C,D,A,g,b]);let L=D.length>0&&!b&&!w&&g&&y.length>0;return(0,l.jsx)(s.Vq,{onDismiss:t,"aria-labelledby":"modal-title",children:(0,l.jsxs)(d.l,{ref:j,onSubmit:function(e){e.preventDefault(),t(),a(D,g)},children:[(0,l.jsx)(x.xB,{icon:u.P,title:"Authenticate with OpenAI",onDismiss:t}),(0,l.jsx)(x.fe,{children:(0,l.jsxs)("div",{className:"flex flex-column",children:[(0,l.jsxs)("div",{className:"f6 mid-gray lh-f6 mb3",children:["Enter an"," ",(0,l.jsx)(i(),{href:"https://help.openai.com/en/articles/4936850-where-do-i-find-my-secret-api-key",className:"pa0 fw5 blue bn bg-transparent pointer",target:"_blank",children:"OpenAI API Key"})," ","to use for all ",c.u7," messages sent by members of this workspace."]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("label",{htmlFor:"ai-service-key",className:"f6 fw5",style:{width:"10rem"},children:"OpenAI API Key"},"ai-service-key"),(0,l.jsx)(m.Z,{id:"ai-service-key",name:"ai-service-key",type:"text",placeholder:"",required:!0,spellCheck:!1,maxLength:255,className:"w-100",onChange:e=>I(e.target.value),value:D})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"f6 fw5",style:{width:"10rem"}}),(0,l.jsxs)("div",{className:"lh-f6 f7 mid-gray w-100 mt1 red",children:[w,"\xa0"]})]}),y.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center mt1",children:[(0,l.jsx)("label",{htmlFor:"model",className:"f6 fw5",style:{width:"10rem"},children:"OpenAI Model"},"model"),(0,l.jsx)(h.P,{id:"model",name:"model",className:"w-100 pa2 bg-light-gray input-reset",onChange:e=>{p(e.target.value)},value:g,children:y.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"f6 fw5",style:{width:"10rem"}}),(0,l.jsx)("div",{className:"lh-f6 f7 mid-gray w-100 mt1",children:"Guests will also be able to use this OpenAI API Key if they can edit the notebook."})]})]})]})}),(0,l.jsx)(x.mz,{children:(0,l.jsxs)(o.CQ,{children:[(0,l.jsx)(o.kq,{text:"Cancel",onClick:t}),(0,l.jsx)(o.KM,{text:"Save",disabled:!L,type:"submit",loading:b})]})})]})})}),v=(0,j.$j)(null,e=>({dispatch:e}))(e=>{let{sending:t,saved:a,onDismiss:n,dispatch:i}=e,[c,h]=(0,r.useState)("");return(0,l.jsx)(s.Vq,{onDismiss:n,"aria-labelledby":"modal-title",children:(0,l.jsxs)(d.l,{onSubmit:function(e){e.preventDefault(),document.activeElement&&document.activeElement.blur(),i({type:"changeEmail",email:c})},children:[(0,l.jsx)(x.xB,{title:a?"Please check your email":"Change email address",onDismiss:n}),(0,l.jsx)(x.fe,{children:a?(0,l.jsx)("div",{children:"You should receive an email momentarily confirming this email address change. If you do not receive it, please check your Spam folder, wait a few minutes, or contact Observable support."}):(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"mb2",children:"You will need to verify the new email in order for the change to take effect."}),(0,l.jsx)(m.Z,{id:"email",name:"email",type:"email",placeholder:"name@example.com",required:!0,maxLength:255,className:"w-100",onChange:e=>h(e.target.value),value:c})]})}),(0,l.jsx)(x.mz,{children:(0,l.jsxs)(o.CQ,{children:[(0,l.jsx)(o.kq,{text:a?"Close":"Cancel",onClick:n}),!a&&(0,l.jsx)(o.KM,{text:"Verify email",loading:t,disabled:!c,type:"submit"})]})})]})})});var g=a(33146);let p=(0,j.$j)(e=>{let{context:t,currentUser:a}=e;return{team:t.context,initialLogin:t.context?t.context.login:a.login}},e=>({dispatch:e}))(e=>{let{team:t,initialLogin:a,onDismiss:n,dispatch:i}=e,[c,m]=(0,r.useState)(a),[h,u]=(0,r.useState)(!1);function f(e){e.preventDefault(),h&&i({type:"changeLogin",login:c})}return(0,l.jsx)(s.Vq,{onDismiss:n,"aria-labelledby":"modal-title",children:(0,l.jsxs)(d.l,{onSubmit:f,children:[(0,l.jsx)(x.xB,{title:"Choose a ".concat(t?"workspace":"personal"," username"),onDismiss:n}),(0,l.jsxs)(x.fe,{children:[(0,l.jsxs)("div",{className:"mid-gray lh-copy mb4",children:["Please choose how to identify"," ",t?"this workspace":"yourself"," on Observable. Take care, you can only change this three times!"]}),(0,l.jsx)(g.Y,{title:"Your".concat(t?" workspace’s":""," URL"),name:"".concat(t?"team ":"","username"),team:t,placeholder:"login",autoFocus:!0,initialLogin:a,onLoginValid:u,onLoginChange:m})]}),(0,l.jsx)(x.mz,{children:(0,l.jsxs)(o.CQ,{children:[(0,l.jsx)(o.kq,{text:"Cancel",onClick:n}),(0,l.jsx)(o.KM,{text:"Set username",onClick:e=>{f(e),n()},disabled:!h,type:"submit"})]})})]})})});var y=a(61802),k=a(46294);let w=(0,j.$j)(e=>{let{currentUser:t}=e;return{currentUser:t}})(e=>{var t;let{team:a,onDismiss:n,currentUser:i}=e,c=(0,r.useRef)(null),[h,u]=(0,r.useState)(!1),[f,j]=(0,r.useState)(""),{data:b}=(0,y.h_)("/team/".concat(a.id,"/members")),v=void 0!==b,g=b&&b.length>1,p=v&&!g&&null!==c.current&&(null===(t=c.current.ack)||void 0===t?void 0:t.value)==="delete this workspace";return(0,l.jsx)(s.Vq,{onDismiss:n,"aria-labelledby":"modal-title",children:(0,l.jsxs)(d.l,{ref:c,method:"POST",onSubmit:function(e){u(!0),e.target.token.value=(0,y.FN)(),(0,k.MR)((0,k.a$)({type:"user:manage:delete",data:{},currentUser:i,eventVersion:1}))},action:"".concat("https://api.observablehq.com","/team/").concat(a.id,"/delete"),children:[(0,l.jsx)("input",{type:"hidden",name:"token"}),(0,l.jsx)(x.xB,{title:g?"Action required":"Delete workspace",onDismiss:n}),(0,l.jsxs)(x.fe,{children:[g?(0,l.jsxs)("div",{className:"mt2 fw7",children:["There ",b.length>2?"are":"is"," currently"," ",b.length-1," other member",b.length-1>1&&"s"," of this workspace. You must remove all other members from the workspace before deleting it."]}):null,v?!g&&(0,l.jsxs)("div",{className:"flex flex-column",children:[(0,l.jsx)("div",{children:"Deleting this workspace will permanently remove its notebooks, collections, and settings. This cannot be undone."}),(0,l.jsxs)("label",{className:"mt3 mb2",htmlFor:"ack",children:["Please acknowledge by typing"," ",(0,l.jsx)("span",{className:"i",children:"delete this workspace"}),":"]}),(0,l.jsx)(m.Z,{className:"",name:"ack",placeholder:"Acknowledgement",value:f,onChange:e=>j(e.target.value)})]}):(0,l.jsx)("div",{className:"mt2 fw7",children:"Checking workspace…"})]}),(0,l.jsx)(x.mz,{children:(0,l.jsx)(o.CQ,{children:g?(0,l.jsx)(o.KM,{text:"Close",onClick:n}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.kq,{text:"Cancel",onClick:n}),(0,l.jsx)(o.KM,{text:"Delete workspace",loading:h,destructive:!0,disabled:!p,type:"submit"})]})})})]})})});var N=a(91529);let C=(0,j.$j)(e=>{let{currentUser:t}=e;return{currentUser:t}},e=>({dispatch:e}))(e=>{var t,a;let{onDismiss:n,currentUser:i}=e,c=(0,r.useRef)(null),[h,u]=(0,r.useState)(!1),[f,j]=(0,r.useState)(""),[b,v]=(0,r.useState)(""),[g,p]=(0,r.useState)();(0,r.useEffect)(()=>{Promise.all(i.teams.filter(e=>"owner"===e.role).map(e=>(0,y.a8)("/team/".concat(e.id,"/members")).then(t=>({team:e,results:t})))).then(e=>p(e.filter(e=>e.results.length>1).map(e=>e.team.login)))},[i]);let w=void 0!==g,C=g&&g.length>0,S=w&&!C&&null!==c.current&&((null===(t=c.current.loginOrEmail)||void 0===t?void 0:t.value)===i.login||(null===(a=c.current.loginOrEmail)||void 0===a?void 0:a.value.trim().toLowerCase())===i.email)&&"delete my account"===c.current.ack.value;return(0,l.jsx)(s.Vq,{onDismiss:n,"aria-labelledby":"modal-title",children:(0,l.jsxs)(d.l,{ref:c,method:"POST",onSubmit:function(e){u(!0),e.target.token.value=(0,y.FN)(),(0,k.MR)((0,k.a$)({type:"user:manage:delete",data:{},currentUser:i,eventVersion:1}))},action:"".concat("https://api.observablehq.com","/user/delete"),children:[(0,l.jsx)("input",{type:"hidden",name:"token"}),(0,l.jsx)(x.xB,{title:C?"Action required":"Delete your account",onDismiss:n}),(0,l.jsxs)(x.fe,{children:[C?(0,l.jsxs)("div",{className:"mt2 fw7",children:["You’re currently an owner on the ",(0,N.If)(g)," ","workspace",g.length>1&&"s",". You must remove yourself from"," ",g.length>1?"these workspaces":"this workspace"," ","before deleting your account."]}):null,w?!C&&(0,l.jsxs)("div",{className:"flex flex-column",children:[(0,l.jsx)("div",{children:"Deleting your account will permanently remove your Observable login, notebooks, collections, and comments. This cannot be undone."}),(0,l.jsx)("label",{className:"mt3 mb2",htmlFor:"email",children:"Enter your username or email:"}),(0,l.jsx)(m.Z,{className:"",spellCheck:!1,name:"loginOrEmail",placeholder:"Username or email",value:f,onChange:e=>j(e.target.value)}),(0,l.jsxs)("label",{className:"mt3 mb2",htmlFor:"ack",children:["Please acknowledge by typing"," ",(0,l.jsx)("span",{className:"i",children:"delete my account"}),":"]}),(0,l.jsx)(m.Z,{className:"",name:"ack",placeholder:"Acknowledgement",value:b,onChange:e=>v(e.target.value)})]}):(0,l.jsx)("div",{className:"mt2 fw7",children:"Checking workspaces…"})]}),(0,l.jsx)(x.mz,{children:(0,l.jsx)(o.CQ,{children:C?(0,l.jsx)(o.KM,{text:"Close",onClick:n}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.kq,{text:"Cancel",onClick:n}),(0,l.jsx)(o.KM,{text:"Delete account",loading:h,destructive:!0,disabled:!S,type:"submit"})]})})})]})})});var S=a(48537);let D=(0,j.$j)(e=>{let{currentUser:t}=e;return{currentUser:t}},e=>({dispatch:e}))(e=>{let{onDismiss:t,dispatch:a,settings:n}=e,i=(0,r.useRef)(null),[c,m]=(0,r.useState)(!1),[h,u]=(0,r.useState)(!1);return(0,l.jsx)(s.Vq,{onDismiss:t,"aria-labelledby":"modal-title",children:(0,l.jsxs)(d.l,{ref:i,onSubmit:function(e){e.preventDefault(),t(),u(!0),a({type:"saveTeamEditorSettings",settings:n})},children:[(0,l.jsx)(x.xB,{title:"Enable Assist",onDismiss:t}),(0,l.jsx)(x.fe,{children:(0,l.jsxs)("div",{className:"flex flex-column",children:[(0,l.jsx)("div",{children:"Please accept these terms of service to enable the notebook assistant..."}),(0,l.jsxs)("div",{className:"flex items-center mt3",children:[(0,l.jsx)(S.X,{onChange:e=>m(e.target.checked),className:"",checked:c,name:"accepted",id:"accepted"}),(0,l.jsx)("label",{className:"ml1",htmlFor:"accepted",children:(0,l.jsx)("div",{className:"f6 fw5 dark-gray lh-solid",children:"Accept"})})]})]})}),(0,l.jsx)(x.mz,{children:(0,l.jsxs)(o.CQ,{children:[(0,l.jsx)(o.kq,{text:"Cancel",onClick:t}),(0,l.jsx)(o.KM,{text:"Save",loading:h,disabled:!c,type:"submit"})]})})]})})});var I=a(61865),A=a(82173);let L=(0,x.zm)({...A.V,addAiServiceKeyModal:b,changeLogin:p,changeEmail:v,changeAvatarOffline:I.E,deleteTeam:w,deleteUser:C,enableAssist:D})}}]);