# 종합 위험요인 분석 및 예방조치 보고서

**생성일**: 2025-11-10  
**검증 범위**: 문서 스위트 전체, 코드베이스 구현 상태  
**기준 문서**: DOCUMENT_SUITE_REFERENCE_ANALYSIS.md

---

## 1. 검증 결과 요약

| 검증 항목 | 일치율 | 위험도 | 상태 |
|----------|--------|--------|------|
| 문서 버전 일관성 | 0/8 (0%) | 🔴 HIGH | **즉시 조치 필요** |
| API 구현 검증 | 5/7 (71.4%) | 🔴 HIGH | **수정 필요** |
| 데이터 스키마 일관성 | 5/15 (33.3%) | 🔴 HIGH | **문서화 필요** |
| 인덱스 전략 | 14/14 (100%) | ✅ LOW | 정상 |
| 비즈니스 로직 검증 | 2/6 (33.3%) | 🔴 HIGH | **구현 필요** |

**전체 일치율**: 26/50 (52%)  
**전체 위험도**: 🔴 **HIGH** - 즉시 조치 필요 항목 다수

---

## 2. 우선순위별 위험요인 분석

### 2.1 Critical Priority (즉시 조치 필요)

#### 2.1.1 문서 버전 불일치

**위험요인**: DOCUMENT_INDEX.md가 실제 문서 버전을 전혀 반영하지 않음

**영향**:
- 개발자 혼란 및 잘못된 문서 참조
- 최신 변경사항 파악 불가능
- 특히 VID v2.0 (Major 버전 변경) 미반영으로 디자인 시스템 오인 가능

**발견 항목**:
- BRD: v1.0 (인덱스) vs v1.1 (실제)
- FRD: v1.0 (인덱스) vs v1.1 (실제)
- SRD: v1.0 (인덱스) vs v1.1 (실제)
- TSD: 미기재 vs v1.1 (실제)
- IA: v1.0 (인덱스) vs v1.1 (실제)
- VID: v1.0 (인덱스) vs v2.0 (실제, Major 변경)
- SITEMAP_WIREFRAME: v1.0 (인덱스) vs v2.1 (실제)
- API_SPECIFICATION: v1.0 (인덱스) vs v1.1 (실제)

**예방조치**:
1. **즉시**: DOCUMENT_INDEX.md 업데이트
2. **단기**: 문서 업데이트 시 인덱스 동기화 프로세스 수립
3. **장기**: 자동화 스크립트 개발

**담당자**: 문서 관리자  
**예상 소요 시간**: 1시간

---

#### 2.1.2 Phase 2 Time Window Rules 미적용

**위험요인**: `getArtistTimeseries`가 Time Window Rules를 적용하지 않고 목업 데이터만 반환

**영향**:
- Phase 2 핵심 기능 실패
- 잘못된 시계열 분석 결과 제공
- 담론 24개월, 제도 10년 가중치 등 비즈니스 규칙 미적용

**발견 항목**:
- `timeWindowRules.js`에 모든 규칙 구현되어 있으나 미사용
- `getArtistTimeseries`가 하드코딩된 목업 데이터만 반환
- measures 컬렉션 조회 없음

**예방조치**:
1. **즉시**: `getArtistTimeseries`에 Time Window Rules 적용 로직 구현
2. **단기**: measures 컬렉션 조회 및 상대 시간축 변환 구현
3. **장기**: 배치 함수(`fnBatchTimeseries`) 구현 확인

**담당자**: Backend 개발팀  
**예상 소요 시간**: 8시간

---

#### 2.1.3 API Path Parameter 처리 오류

**위험요인**: 모든 엔드포인트가 query parameter로 처리하여 Firebase Hosting rewrites와 불일치

**영향**:
- 실제 배포 환경에서 라우팅 실패 가능성
- 클라이언트가 스펙 기반으로 호출 시 오류 발생

**발견 항목**:
- `getArtistSummary`: `req.query.id` 사용 (스펙: `req.params.id`)
- `getArtistSunburst`: `req.query.id` 사용 (스펙: `req.params.id`)
- `getArtistTimeseries`: `req.query.axis` 사용 (스펙: `req.params.axis`)
- `getCompareArtists`: `req.query.axis` 사용 (스펙: `req.params.axis`)

**예방조치**:
1. **즉시**: 모든 엔드포인트의 path parameter 처리 수정
2. **단기**: Firebase Hosting rewrites와 일치 확인
3. **장기**: API 테스트 자동화

**담당자**: Backend 개발팀  
**예상 소요 시간**: 4시간

---

#### 2.1.4 API 응답 스키마 불일치

**위험요인**: API 스펙의 표준 응답 형식 `{ data: {...}, meta: {...} }` 미준수

**영향**:
- 클라이언트 코드가 스펙 기반으로 작성된 경우 파싱 오류
- 에러 응답 형식 불일치로 에러 처리 실패

**발견 항목**:
- 모든 엔드포인트가 직접 데이터 반환 (data 래퍼 없음)
- 에러 응답 형식 불일치

**예방조치**:
1. **즉시**: 모든 성공 응답에 표준 래퍼 적용
2. **단기**: 에러 응답 형식 표준화
3. **장기**: API 스키마 검증 자동화

**담당자**: Backend 개발팀  
**예상 소요 시간**: 6시간

---

### 2.2 High Priority (단기 조치 필요)

#### 2.2.1 미구현 API 엔드포인트 (2개)

**위험요인**: FR-P2-BAT-001, FR-P2-EVT-001 미구현

**영향**:
- Phase 2 UI 기능 제한
- 성능 최적화 불가능 (배치 API 없음)
- 이벤트 영향 분석 불가능

**발견 항목**:
- `POST /api/batch/timeseries`: 미구현
- `GET /api/artist/{id}/events/{axis}`: 미구현

**예방조치**:
1. **단기**: 두 엔드포인트 구현 우선순위 결정
2. **단기**: 구현 일정 수립
3. **장기**: 기능 완성도 모니터링

**담당자**: Backend 개발팀  
**예상 소요 시간**: 16시간

---

#### 2.2.2 문서에 없는 컬렉션 사용 (5개)

**위험요인**: 코드에서 사용하는 컬렉션이 문서에 정의되지 않음

**영향**:
- 신규 개발자 혼란
- 데이터 구조 파악 불가능
- 유지보수 어려움

**발견 항목**:
- `artist_sunburst`: 문서에 없음
- `artist_comparisons`: 문서에는 `compare_pairs`
- `sunburst_snapshots`: 문서에 없음
- `ai_reports`: 문서에 없음
- `system_health`: 문서에 없음

**예방조치**:
1. **단기**: 모든 컬렉션 문서화
2. **단기**: 컬렉션명 통일 (`artist_comparisons` → `compare_pairs`)
3. **장기**: 스키마 문서 자동화

**담당자**: Data Architect  
**예상 소요 시간**: 4시간

---

#### 2.2.3 피지컬 컴퓨팅 컬렉션 Rules 누락

**위험요인**: 피지컬 컴퓨팅 컬렉션에 보안 규칙 없음

**영향**:
- 보안 취약점
- 접근 제어 불가능

**발견 항목**:
- `physical_game_sessions`: Rules 없음
- `treasure_boxes`: Rules 없음
- `treasure_box_combinations`: Rules 없음

**예방조치**:
1. **단기**: firestore.rules에 보안 규칙 추가
2. **단기**: 보안 규칙 테스트
3. **장기**: 보안 규칙 자동화 검증

**담당자**: Backend 개발팀  
**예상 소요 시간**: 2시간

---

### 2.3 Medium Priority (중기 조치 필요)

#### 2.3.1 일관성 검증 API 레벨 미실행

**위험요인**: `dataQualityValidator.js`는 구현되어 있으나 API에서 호출 여부 불명확

**영향**:
- 일관성 검증 실패 데이터가 API로 노출될 수 있음
- ±0.5p 규칙 위반 데이터 제공 가능

**예방조치**:
1. **중기**: `getArtistSummary`에서 일관성 검증 실행 확인
2. **중기**: 검증 실패 시 에러 반환 로직 추가
3. **장기**: 일관성 검증 자동화

**담당자**: Backend 개발팀  
**예상 소요 시간**: 2시간

---

#### 2.3.2 실시간 계산 로직 부재

**위험요인**: Phase 1, 3에서 실시간 계산 없이 사전 계산된 데이터만 사용

**영향**:
- 배치 함수 실패 시 데이터 제공 불가능
- 유연성 부족

**예방조치**:
1. **중기**: 실시간 계산 로직 구현 (선택적)
2. **중기**: 배치 함수 안정성 확보
3. **장기**: 폴백 메커니즘 강화

**담당자**: Backend 개발팀  
**예상 소요 시간**: 16시간

---

#### 2.3.3 비교 분석 알고리즘 미구현

**위험요인**: Phase 3 비교 분석이 보간, 상관계수, AUC 계산 없이 목업만 반환

**영향**:
- 정확한 비교 분석 불가능
- Phase 3 기능 제한

**예방조치**:
1. **중기**: 비교 분석 알고리즘 구현
2. **중기**: 보간, 상관계수, AUC 계산 로직 추가
3. **장기**: 알고리즘 테스트

**담당자**: Backend 개발팀  
**예상 소요 시간**: 12시간

---

## 3. 예방조치 실행 계획

### 3.1 Week 1 (즉시 조치)

**목표**: Critical Priority 위험요인 해결

| 작업 | 담당자 | 소요 시간 | 우선순위 |
|------|--------|----------|----------|
| DOCUMENT_INDEX.md 업데이트 | 문서 관리자 | 1h | P0 |
| API Path Parameter 처리 수정 | Backend | 4h | P0 |
| API 응답 스키마 표준화 | Backend | 6h | P0 |
| getArtistTimeseries Time Window Rules 적용 | Backend | 8h | P0 |

**총 소요 시간**: 19시간

---

### 3.2 Week 2-3 (단기 조치)

**목표**: High Priority 위험요인 해결

| 작업 | 담당자 | 소요 시간 | 우선순위 |
|------|--------|----------|----------|
| POST /api/batch/timeseries 구현 | Backend | 8h | P1 |
| GET /api/artist/{id}/events/{axis} 구현 | Backend | 8h | P1 |
| 문서에 없는 컬렉션 문서화 | Data Architect | 4h | P1 |
| 피지컬 컴퓨팅 컬렉션 Rules 추가 | Backend | 2h | P1 |

**총 소요 시간**: 22시간

---

### 3.3 Month 1-2 (중기 조치)

**목표**: Medium Priority 위험요인 해결

| 작업 | 담당자 | 소요 시간 | 우선순위 |
|------|--------|----------|----------|
| 일관성 검증 API 레벨 실행 | Backend | 2h | P2 |
| 실시간 계산 로직 구현 | Backend | 16h | P2 |
| 비교 분석 알고리즘 구현 | Backend | 12h | P2 |

**총 소요 시간**: 30시간

---

## 4. 위험요인 영향도 매트릭스

| 위험요인 | 발생 확률 | 영향도 | 위험도 | 조치 우선순위 |
|----------|----------|--------|--------|--------------|
| 문서 버전 불일치 | 높음 | 중간 | 🔴 HIGH | P0 |
| Phase 2 Time Window Rules 미적용 | 높음 | 높음 | 🔴 HIGH | P0 |
| API Path Parameter 처리 오류 | 높음 | 높음 | 🔴 HIGH | P0 |
| API 응답 스키마 불일치 | 높음 | 중간 | 🔴 HIGH | P0 |
| 미구현 API 엔드포인트 | 중간 | 중간 | 🟡 MEDIUM | P1 |
| 문서에 없는 컬렉션 사용 | 중간 | 낮음 | 🟡 MEDIUM | P1 |
| 피지컬 컴퓨팅 컬렉션 Rules 누락 | 낮음 | 높음 | 🟡 MEDIUM | P1 |
| 일관성 검증 API 레벨 미실행 | 중간 | 낮음 | 🟢 LOW | P2 |
| 실시간 계산 로직 부재 | 낮음 | 중간 | 🟢 LOW | P2 |
| 비교 분석 알고리즘 미구현 | 낮음 | 중간 | 🟢 LOW | P2 |

---

## 5. 모니터링 및 추적

### 5.1 위험요인 추적

**추적 방법**:
- GitHub Issues로 각 위험요인 추적
- 주간 리뷰 미팅에서 진행 상황 확인
- 완료 시 검증 보고서 업데이트

**메트릭**:
- 위험요인 해결율: 목표 80% (Week 1), 100% (Month 2)
- 코드 커버리지: 목표 70% (Phase 1-4 핵심 로직)
- 문서 일치율: 목표 95%

---

### 5.2 검증 자동화

**자동화 항목**:
1. 문서 버전 일관성 검증 스크립트
2. API 스키마 검증 테스트
3. 데이터 스키마 일치 여부 검증
4. 인덱스 일치 여부 검증
5. 비즈니스 로직 테스트

**CI/CD 통합**:
- PR 생성 시 자동 검증 실행
- 검증 실패 시 PR 머지 차단

---

## 6. 결론

현재 코드베이스는 문서 스위트와 52% 일치율을 보이며, Critical Priority 위험요인이 4개 발견되었습니다. 특히 Phase 2 Time Window Rules 미적용은 핵심 기능 실패로 이어질 수 있어 즉시 조치가 필요합니다.

**즉시 조치 항목**:
1. DOCUMENT_INDEX.md 업데이트
2. getArtistTimeseries에 Time Window Rules 적용
3. API Path Parameter 처리 수정
4. API 응답 스키마 표준화

**예상 완료 시점**: Week 1 (Critical Priority), Month 2 (전체)

---

**보고서 작성일**: 2025-11-10  
**다음 검토일**: Week 1 완료 후 재검증

